# üìö Bookstore API (v3)

A **Node.js + TypeScript** REST API for managing **books and categories**, powered by **Express**, **Drizzle ORM**, and **PostgreSQL**.

Now fully migrated to use **UUID-based identifiers** instead of numeric IDs, improving data consistency and scalability across distributed systems.

---

## ‚ö° Quick Start

```bash
git clone https://github.com/ryanaxondev/express-book-management.git
cd express-book-management
npm install
cp .env.example .env
# Update .env values if needed
docker compose up -d
npm run db:push
npm run dev
```

> The API will run at **[http://localhost:3000](http://localhost:3000)** by default.

---

## üß± Tech Stack

* **Node.js + TypeScript**
* **Express.js**
* **Drizzle ORM**
* **PostgreSQL (Docker)**
* **Docker Compose**
* **Zod (Validation)**

---

## üóÇ Project Structure

```
bookstore/
‚îÇ‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app.ts                     # Express app configuration
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ books.ts               # Book routes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ categoryRoutes.ts      # Category routes
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bookController.ts      # Book logic (with category support)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ categoryController.ts  # Category CRUD logic
‚îÇ   ‚îú‚îÄ‚îÄ validation/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bookSchema.ts          # Zod schemas for book validation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ categorySchema.ts      # Zod schemas for category validation
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mapToBookWithCategory.ts # Map joined DB rows to BookWithCategory
‚îÇ   ‚îî‚îÄ‚îÄ db/
‚îÇ       ‚îú‚îÄ‚îÄ index.ts               # Drizzle + PostgreSQL connection
‚îÇ       ‚îî‚îÄ‚îÄ schema.ts              # Database schema (Books + Categories)
‚îÇ
‚îÇ‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ postman/
‚îÇ       ‚îú‚îÄ‚îÄ Bookstore_API_Pro_Collection.json   # Postman collection for all endpoints
‚îÇ       ‚îî‚îÄ‚îÄ Bookstore_API_Environment.json      # Postman environment configuration
‚îÇ
‚îÇ‚îÄ‚îÄ server.ts                      # Entry point
‚îÇ‚îÄ‚îÄ package.json
‚îÇ‚îÄ‚îÄ tsconfig.json
‚îÇ‚îÄ‚îÄ drizzle.config.ts
‚îÇ‚îÄ‚îÄ docker-compose.yml
‚îÇ‚îÄ‚îÄ .env
‚îÇ‚îÄ‚îÄ .env.example
‚îÇ‚îÄ‚îÄ .gitignore
‚îÇ‚îÄ‚îÄ CHANGELOG.md
```

---

## ‚öôÔ∏è Environment Variables

```env
DATABASE_URL=postgres://postgres:mysecretpassword@localhost:5433/bookstore
PORT=3000
```

> Keep host/port consistent with `docker-compose.yml` when using Docker.

---

## üõ£Ô∏è Docker Setup

```bash
docker compose up -d
```

> Starts a PostgreSQL container on port `5433`.

Verify connection:

```bash
psql -h localhost -p 5433 -U postgres -d bookstore
```

---

## üß± Database (Drizzle ORM + UUID)

### UUID Integration

All tables now use `UUID` instead of `serial` numeric IDs. UUIDs are automatically generated by PostgreSQL using `gen_random_uuid()`.

```ts
id: uuid('id').defaultRandom().primaryKey(),
```

Apply migrations:

```bash
npm run db:push
```

Generate new migrations:

```bash
npm run db:generate
```

---

## üöÄ Running the API

### Development

```bash
npm run dev
```

### Production

```bash
npm run build
npm start
```

---

## üìö API Endpoints (UUID Version)

### üíò Books

| Method | Endpoint     | Description             | Request Body Example                                                                                           |
| ------ | ------------ | ----------------------- | -------------------------------------------------------------------------------------------------------------- |
| GET    | `/books`     | Get all books           | ‚Äî                                                                                                              |
| GET    | `/books/:id` | Get a single book by ID | ‚Äî                                                                                                              |
| POST   | `/books`     | Add a new book          | `{ "title": "Book A", "author": "John Doe", "description": "A short description", "categoryId": "uuid-here" }` |
| PUT    | `/books/:id` | Update book details     | `{ "title": "Updated", "author": "Jane Doe", "categoryId": "uuid-here" }`                                      |
| DELETE | `/books/:id` | Delete a book by ID     | ‚Äî                                                                                                              |

**Example Response:**

```json
{
  "id": "bf8f752c-8e83-49eb-8afc-163b0573ddda",
  "title": "1984",
  "author": "George Orwell",
  "description": "A dystopian novel",
  "categoryId": "c03f49ca-343e-4be0-8f5f-74b9bfe0da5e",
  "category": {
    "id": "c03f49ca-343e-4be0-8f5f-74b9bfe0da5e",
    "name": "Fiction",
    "description": "Narrative works"
  }
}
```

---

### üè∑Ô∏è Categories

| Method | Endpoint          | Description           | Request Body Example                                          |
| ------ | ----------------- | --------------------- | ------------------------------------------------------------- |
| GET    | `/categories`     | Get all categories    | ‚Äî                                                             |
| GET    | `/categories/:id` | Get category by ID    | ‚Äî                                                             |
| POST   | `/categories`     | Create a new category | `{ "name": "Science", "description": "Books about physics" }` |
| PUT    | `/categories/:id` | Update a category     | `{ "name": "Tech", "description": "Updated description" }`    |
| DELETE | `/categories/:id` | Delete a category     | ‚Äî                                                             |

> Deleting a category will **not** delete related books; their `categoryId` becomes `NULL`.

---

## ‚úÖ Validation & Error Handling (Zod)

* All `POST` and `PUT` requests for **Books** and **Categories** are validated using **Zod schemas**.

* Includes strict UUID validation via:

  ```ts
  const uuidSchema = z.string().uuid();
  ```

* Validation errors return structured, human-readable JSON responses:

  ```json
  {
    "error": {
      "categoryId": "Invalid UUID format"
    }
  }
  ```

---

## üí™ TypeScript Models

```ts
export type UUID = string & { readonly brand: unique symbol };

export type Category = {
  id: UUID;
  name: string;
  description?: string | null;
};

export type BookInput = {
  title: string;
  author: string;
  description?: string | null;
  categoryId?: UUID | null;
};

export type BookWithCategory = BookInput & {
  id: UUID;
  category?: Category | null;
};
```

---

## ü§ñ Utility: mapToBookWithCategory

```ts
import { BookWithCategory, UUID } from "../types/bookTypes.js";

export const mapToBookWithCategory = (row: any): BookWithCategory => ({
  id: row.id as UUID,
  title: row.title,
  author: row.author,
  description: row.description ?? null,
  categoryId: row.categoryId ?? null,
  category: row.categories_id
    ? {
        id: row.categories_id as UUID,
        name: row.categories_name,
        description: row.categories_description ?? null,
      }
    : null,
});
```

---

## üë©‚Äçüíª Postman Setup

Use the updated Postman collection and environment under `/docs/postman`.

### Example Environment:

```json
{
  "base_url": "http://localhost:3000",
  "book_id": "bf8f752c-8e83-49eb-8afc-163b0573ddda",
  "category_id": "c03f49ca-343e-4be0-8f5f-74b9bfe0da5e"
}
```

---

## üïπÔ∏è Testing

```bash
curl -X POST http://localhost:3000/categories \
  -H "Content-Type: application/json" \
  -d '{"name": "Fiction", "description": "Narrative works"}'
```

All CRUD routes were verified using **curl** and **Postman** with UUID-based data.

---

## üõ†Ô∏è npm Scripts

```json
{
  "dev": "tsx watch server.ts",
  "build": "tsc",
  "start": "node dist/server.js",
  "db:generate": "drizzle-kit generate:pg",
  "db:push": "drizzle-kit push:pg"
}
```

---

## üìà Summary of v3 (UUID Migration)

* All numeric IDs replaced with **UUID** types.
* New `UUID` type introduced in `bookTypes.ts`.
* Updated all controllers, routes, and validation schemas to handle UUIDs.
* Added `mapToBookWithCategory` util for joined query mapping.
* Updated Postman collection and environment with UUID examples.
* Verified CRUD operations end-to-end with real data.

---

## üíº License

This project is licensed under the **MIT License**.

---

### üíé Part of the AXON Open Source Ecosystem

This project is part of **AXON**, a collection of open-source tools and libraries designed for high-quality, scalable web development.
